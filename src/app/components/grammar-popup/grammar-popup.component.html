<app-bottom-sheet [isOpen]="isOpen()" [showDragHandle]="true" [showCloseButton]="true" (closed)="onSheetClosed()">
    <div class="popup-content">
        @if (pattern(); as p) {
        <!-- Header -->
        <div class="popup-header">
            <h2 class="popup-word">{{ p.pattern }}</h2>
            <span class="badge" [ngClass]="levelClass()">{{ p.level }}</span>
        </div>

        <!-- Body -->
        <div class="popup-body">
            <!-- Formation -->
            @if (p.formation) {
            <div class="popup-section">
                <div class="section-label">{{ i18n.t('grammar.formation') }}</div>
                <div class="formation-box">{{ p.formation }}</div>
            </div>
            }

            <!-- Explanation -->
            <div class="popup-section">
                <div class="section-label">{{ i18n.t('grammar.explanation') }}</div>
                <p class="explanation-text">{{ p.shortExplanation }}</p>
                @if (p.longExplanation && p.longExplanation !== p.shortExplanation) {
                <p class="explanation-long">{{ p.longExplanation }}</p>
                }
            </div>

            <!-- Examples -->
            @if (p.examples && p.examples.length > 0) {
            <div class="popup-section">
                <div class="section-label">{{ i18n.t('grammar.examples') }}</div>
                <div class="examples-list">
                    @for (example of p.examples.slice(0, 3); track $index) {
                    <div class="example-item">
                        <span class="example-num">{{ $index + 1 }}</span>
                        <div class="example-content">
                            <span class="example-sentence">{{ example.sentence }}</span>
                            @if (example.romanization) {
                            <span class="example-romanization">{{ example.romanization }}</span>
                            }
                            <span class="example-translation">{{ example.translation }}</span>
                        </div>
                    </div>
                    }
                </div>
            </div>
            }
        </div>
        }
    </div>
</app-bottom-sheet>