<div class="vocab-panel">
    <div class="vocab-header">
        <div class="header-row">
            <app-icon name="book-open" [size]="20" class="vocab-icon" />
            <h2 class="vocab-title">{{ i18n.t('vocab.title') }}</h2>
        </div>
        <div class="vocab-badges">
            <span class="badge badge--new">{{ vocab.getStatsByLanguage(settings.settings().language).new }} {{
                i18n.t('vocab.new') }}</span>
            <span class="badge badge--learning">{{ vocab.getStatsByLanguage(settings.settings().language).learning }} {{
                i18n.t('vocab.learning') }}</span>
            <span class="badge badge--known">{{ vocab.getStatsByLanguage(settings.settings().language).known }} {{
                i18n.t('vocab.known') }}</span>
        </div>
    </div>

    <!-- Filters -->
    <div class="vocab-filters">
        <div class="search-wrapper input-group--icon">
            <app-icon name="search" [size]="16" class="input-icon" />
            <input type="text" class="search-input" [placeholder]="i18n.t('vocab.search')" [(ngModel)]="searchQuery" />
            @if (searchQuery) {
            <button class="clear-btn" (click)="clearSearch()">
                <app-icon name="x" [size]="14" />
            </button>
            }
        </div>
        <button class="filter-btn" (click)="filterPickerOpen.set(true)">
            <span>{{ levelFilter() === 'all' ? i18n.t('vocab.allLevels') : i18n.t('vocab.' + levelFilter()) }}</span>
            <app-icon name="chevron-down" [size]="14" />
        </button>
    </div>

    <!-- Word list -->
    <div class="word-list">
        @if (filteredWords().length === 0) {
        <div class="empty-state">
            @if (vocab.vocabulary().length === 0) {
            <app-icon name="book-open" [size]="32" class="empty-state__icon" />
            <p class="empty-state__title">{{ i18n.t('vocab.noWordsSaved') }}</p>
            <p class="empty-state__hint">{{ i18n.t('vocab.clickWordsToSave') }}</p>
            } @else {
            <app-icon name="search" [size]="24" class="empty-state__icon" />
            <p class="empty-state__title">{{ i18n.t('vocab.noMatchesFound') }}</p>
            }
        </div>
        } @else {
        <div class="vocab-items">
            @for (item of paginatedWords(); track item.id) {
            <div class="vocab-item">
                <div class="vocab-item__content">
                    <div class="vocab-item__header">
                        <span class="vocab-item__word" [class]="'text-' + item.language">
                            {{ item.word }}
                        </span>
                        @if (item.reading || item.pinyin || item.romanization) {
                        <span class="vocab-item__reading">
                            {{ item.reading || item.pinyin || item.romanization }}
                        </span>
                        }
                    </div>
                    <p class="vocab-item__meaning">{{ item.meaning || i18n.t('vocab.noDefinition') }}</p>
                </div>

                <div class="vocab-item__actions">
                    <button class="level-badge" [class]="'level-badge--' + item.level"
                        (click)="openLevelPicker(item.id)">
                        <span class="level-dot"></span>
                        <span class="level-text">{{ item.level }}</span>
                    </button>

                    <button class="btn btn-icon btn-ghost delete-btn" (click)="deleteWord(item.id)" title="Delete">
                        <app-icon name="trash-2" [size]="16" />
                    </button>
                </div>
            </div>
            }
        </div>
        }
    </div>

    <!-- Pagination -->
    @if (totalPages() > 1) {
    <div class="vocab-pagination">
        <button class="btn btn-icon btn-sm btn-ghost" [disabled]="currentPage() === 1" (click)="prevPage()">
            <app-icon name="chevron-left" [size]="16" />
        </button>
        <span class="pagination-info">
            {{ currentPage() }} / {{ totalPages() }}
        </span>
        <button class="btn btn-icon btn-sm btn-ghost" [disabled]="currentPage() === totalPages()" (click)="nextPage()">
            <app-icon name="chevron-right" [size]="16" />
        </button>
    </div>
    }

    <!-- Actions -->
    <div class="vocab-actions">
        <button class="btn btn-sm btn-secondary" (click)="exportJSON()">
            <app-icon name="download" [size]="14" />
            {{ i18n.t('vocab.json') }}
        </button>
        <button class="btn btn-sm btn-secondary" (click)="exportAnki()">
            <app-icon name="download" [size]="14" />
            {{ i18n.t('vocab.anki') }}
        </button>
        <label class="btn btn-sm btn-ghost import-btn">
            <app-icon name="upload" [size]="14" />
            {{ i18n.t('vocab.import') }}
            <input type="file" accept=".json" class="hidden-input" (change)="importJSON($event)" />
        </label>
    </div>
</div>

<!-- Delete Confirmation Sheet -->
<app-bottom-sheet [isOpen]="deleteModalVisible()" [showCloseButton]="false" (closed)="cancelDelete()">
    <div class="delete-sheet">
        <div class="delete-sheet__header">
            <div class="delete-sheet__icon">
                <app-icon name="trash-2" [size]="24" />
            </div>
            <h3 class="delete-sheet__title">{{ i18n.t('vocab.deleteWord') }}</h3>
        </div>
        <p class="delete-sheet__message">{{ i18n.t('vocab.deleteConfirm') }}</p>
        <div class="delete-sheet__actions">
            <button class="btn btn-secondary" (click)="cancelDelete()">{{ i18n.t('vocab.cancel') }}</button>
            <button class="btn btn-danger" (click)="confirmDelete()">{{ i18n.t('vocab.delete') }}</button>
        </div>
    </div>
</app-bottom-sheet>

<!-- Toast Notification -->
@if (toastMessage()) {
<div class="toast" [class.toast--error]="toastType() === 'error'">
    <app-icon [name]="toastType() === 'error' ? 'alert-circle' : 'check'" [size]="18" />
    <span>{{ toastMessage() }}</span>
</div>
}

<!-- Filter Picker -->
<app-option-picker [options]="filterOptions()" [value]="levelFilter()" [isOpen]="filterPickerOpen()"
    [title]="i18n.t('vocab.filterByLevel')" (selected)="onLevelFilterChange($event)"
    (closed)="filterPickerOpen.set(false)" />

<!-- Level Picker -->
<app-option-picker [options]="levelOptions()" [value]="getEditingItemLevel()" [isOpen]="levelPickerOpen()"
    [title]="i18n.t('vocab.changeLevel')" (selected)="onLevelChange($event)"
    (closed)="levelPickerOpen.set(false); editingItemId.set(null)" />