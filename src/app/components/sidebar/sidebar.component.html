<aside class="sidebar" [class.collapsed]="isCollapsed()">
    <!-- Toggle Button (Floating) -->
    <button class="sidebar-toggle" (click)="toggleCollapse()"
        [attr.aria-label]="isCollapsed() ? 'Expand sidebar' : 'Collapse sidebar'">
        <app-icon [name]="isCollapsed() ? 'chevron-right' : 'chevron-left'" [size]="16" />
    </button>

    <!-- Logo / Brand -->
    <div class="sidebar__brand">
        <div class="sidebar__logo">
            <span class="logo-text">è¨€</span>
        </div>
        @if (!isCollapsed()) {
        <div class="sidebar__title-group">
            <h1 class="sidebar__title">{{ i18n.t('app.title') }}</h1>
            <span class="sidebar__subtitle">{{ i18n.t('app.subtitle') }}</span>
        </div>
        }
    </div>

    <!-- Navigation -->
    <nav class="sidebar__nav">
        <a class="nav-item" routerLink="/video" routerLinkActive="active">
            <app-icon name="play-circle" [size]="20" />
            @if (!isCollapsed()) {
            <span>{{ i18n.t('nav.video') }}</span>
            }
        </a>
        <a class="nav-item" routerLink="/dictionary" routerLinkActive="active">
            <app-icon name="book-open" [size]="20" />
            @if (!isCollapsed()) {
            <span>{{ i18n.t('nav.words') }}</span>
            }
        </a>
        <a class="nav-item" routerLink="/study" routerLinkActive="active">
            <app-icon name="graduation-cap" [size]="20" />
            @if (!isCollapsed()) {
            <span>{{ i18n.t('nav.study') }}</span>
            }
        </a>
        <a class="nav-item" routerLink="/history" routerLinkActive="active">
            <app-icon name="clock" [size]="20" />
            @if (!isCollapsed()) {
            <span>{{ i18n.t('history.title') }}</span>
            }
        </a>
    </nav>

    <!-- Language Selector -->
    @if (!isCollapsed()) {
    <div class="sidebar__section lang-section">
        <h3 class="section-label">{{ i18n.t('settings.learningLanguage') }}</h3>
        <button class="lang-row" (click)="showLangPicker.set(true)">
            <img [src]="currentLang().flag" class="lang-row__flag" alt="" />
            <span class="lang-row__name">{{ currentLang().name }}</span>
            <app-icon name="chevron-right" [size]="16" class="lang-row__chevron" />
        </button>
    </div>
    } @else {
    <!-- Collapsed: Just show flag icon -->
    <div class="sidebar__section lang-section-collapsed">
        <button class="lang-flag-btn" (click)="showLangPicker.set(true)" [attr.title]="currentLang().name">
            <img [src]="currentLang().flag" class="lang-flag-btn__flag" alt="" />
        </button>
    </div>
    }

    <!-- Streak Goal (Motivation) -->
    @if (!isCollapsed()) {
    <div class="sidebar__section">
        <div class="streak-card" [attr.title]="i18n.t('streak.longestStreak') + ': ' + streak.longestStreak()">
            <div class="streak-icon-wrapper">
                <app-icon name="fire" [size]="20" class="streak-icon" />
            </div>
            <div class="streak-info">
                <span class="streak-count">{{ streak.currentStreak() }}</span>
                <span class="streak-label">{{ i18n.t('streak.dayStreak') || 'Day Streak' }}</span>
            </div>
            @if (streak.freezesRemaining() > 0 && streak.currentStreak() > 0) {
            <div class="streak-freezes" [attr.title]="i18n.t('streak.freezesRemaining')">
                <app-icon name="snowflake" [size]="14" />
                <span>{{ streak.freezesRemaining() }}</span>
            </div>
            }
        </div>
    </div>
    }

    <!-- Footer Actions -->
    <div class="sidebar__footer">
        <!-- Collapsed Streak Indicator -->
        @if (isCollapsed()) {
        <div class="collapsed-streak" [attr.title]="i18n.t('streak.dayStreak')">
            <app-icon name="fire" [size]="18" />
            <span class="collapsed-streak-count">{{ streak.currentStreak() }}</span>
        </div>
        }

        @if (auth.isLoggedIn()) {
        <button class="footer-btn" (click)="openSettings.emit()">
            <img [src]="auth.user()?.picture" [alt]="auth.user()?.name" class="user-avatar" />
            @if (!isCollapsed()) {
            <span class="user-name">{{ auth.user()?.name }}</span>
            <span class="badge" [class]="'badge--' + auth.getSubscriptionTier()"
                style="margin-left: auto; font-size: 0.65rem; padding: 1px 6px;">
                {{ auth.getSubscriptionTier() | uppercase }}
            </span>
            }
        </button>
        } @else if (auth.isInitialized() && auth.isAuthEnabled()) {
        <button class="footer-btn login-btn" (click)="loginWithGoogle()" [disabled]="isLoggingIn">
            <app-icon name="user" [size]="20" />
            @if (!isCollapsed()) {
            <span>{{ i18n.t('header.signIn') }}</span>
            }
        </button>
        }

        <button class="footer-btn" (click)="openSettings.emit()" [attr.title]="i18n.t('nav.settings')">
            <app-icon name="settings" [size]="20" />
            @if (!isCollapsed()) {
            <span>{{ i18n.t('nav.settings') }}</span>
            }
        </button>

        <button class="footer-btn" (click)="toggleTheme()"
            [attr.title]="settings.getEffectiveTheme() === 'dark' ? i18n.t('header.switchToLight') : i18n.t('header.switchToDark')">
            @if (settings.getEffectiveTheme() === 'dark') {
            <app-icon name="sun" [size]="20" />
            } @else {
            <app-icon name="moon" [size]="20" />
            }
            @if (!isCollapsed()) {
            <span>{{ settings.getEffectiveTheme() === 'dark' ? i18n.t('settings.switchToLightMode') :
                i18n.t('settings.switchToDarkMode') }}</span>
            }
        </button>
    </div>
</aside>

<!-- Learning Language Picker -->
<app-option-picker [options]="learningLangOptions()" [value]="settings.settings().language" [isOpen]="showLangPicker()"
    [title]="i18n.t('settings.learningLanguage')" (selected)="onLangSelected($event)"
    (closed)="showLangPicker.set(false)" />