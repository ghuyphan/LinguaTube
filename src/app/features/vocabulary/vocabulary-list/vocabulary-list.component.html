<div class="vocab-panel">
    <div class="vocab-header">
        <div class="header-row">
            <app-icon name="book-open" [size]="20" class="vocab-icon" />
            <h2>{{ i18n.t('vocab.title') }}</h2>
        </div>
        <p class="vocab-subtitle">{{ vocab.getStatsByLanguage(settings.settings().language).total }} {{
            i18n.t('vocab.words') }}</p>
    </div>

    <!-- Search / Filters -->
    <div class="vocab-filters">
        <div class="search-box input-group--icon">
            <app-icon name="search" [size]="16" class="input-icon" />
            <input type="text" [(ngModel)]="searchQuery" [placeholder]="i18n.t('vocab.search')" class="search-input" />
            @if (searchQuery) {
            <button class="clear-btn" (click)="clearSearch()">
                <app-icon name="x" [size]="14" />
            </button>
            }
        </div>
        <button class="filter-btn" (click)="filterPickerOpen.set(true)">
            <span>{{ levelFilter() === 'all' ? i18n.t('vocab.allLevels') : i18n.t('vocab.' + levelFilter()) }}</span>
            <app-icon name="chevron-down" [size]="14" />
        </button>
        <button class="btn btn-icon btn-ghost menu-btn" (click)="menuOpen.set(true)">
            <app-icon name="more-vertical" [size]="18" />
        </button>
    </div>

    <!-- Word list -->
    <div class="word-list">
        @if (filteredWords().length === 0) {
        <div class="empty-state">
            @if (vocab.vocabulary().length === 0) {
            <div class="empty-state__icon-box">
                <app-icon name="book-open" [size]="20" />
            </div>
            <div class="empty-state__text">
                <p class="empty-state__title">{{ i18n.t('vocab.noWordsSaved') }}</p>
                <p class="empty-state__description">{{ i18n.t('vocab.clickWordsToSave') }}</p>
            </div>
            } @else {
            <div class="empty-state__icon-box">
                <app-icon name="search" [size]="20" />
            </div>
            <div class="empty-state__text">
                <p class="empty-state__title">{{ i18n.t('vocab.noMatchesFound') }}</p>
                <p class="empty-state__description">{{ i18n.t('dictionary.tryDifferent') }}</p>
            </div>
            }
        </div>
        } @else {
        <div class="vocab-items">
            @for (item of paginatedWords(); track item.id) {
            <div class="vocab-item">
                <div class="vocab-item__content">
                    <div class="vocab-item__header">
                        <span class="vocab-item__word" [class]="'text-' + item.language">
                            {{ item.word }}
                        </span>
                        @if (item.reading || item.pinyin || item.romanization) {
                        <span class="vocab-item__reading">
                            {{ item.reading || item.pinyin || item.romanization }}
                        </span>
                        }
                    </div>
                    <p class="vocab-item__meaning">{{ item.meaning || i18n.t('vocab.noDefinition') }}</p>
                </div>

                <div class="vocab-item__actions">
                    <button class="level-dot-btn" [class]="'level--' + item.level" (click)="openLevelPicker(item.id)"
                        [title]="item.level">
                    </button>
                    <button class="btn btn-icon btn-ghost delete-btn" (click)="deleteWord(item.id)" title="Delete">
                        <app-icon name="trash-2" [size]="16" />
                    </button>
                </div>
            </div>
            }
        </div>
        }
    </div>

    <!-- Pagination -->
    @if (totalPages() > 1) {
    <div class="vocab-pagination">
        <button class="btn btn-icon btn-sm btn-ghost" [disabled]="currentPage() === 1" (click)="prevPage()">
            <app-icon name="chevron-left" [size]="16" />
        </button>
        <span class="pagination-info">
            {{ currentPage() }} / {{ totalPages() }}
        </span>
        <button class="btn btn-icon btn-sm btn-ghost" [disabled]="currentPage() === totalPages()" (click)="nextPage()">
            <app-icon name="chevron-right" [size]="16" />
        </button>
    </div>
    }
</div>

<!-- Delete Confirmation -->
<app-confirm-dialog [isOpen]="deleteModalVisible()" [title]="i18n.t('vocab.deleteWord')"
    [message]="i18n.t('vocab.deleteConfirm')" [confirmText]="i18n.t('vocab.delete')"
    [cancelText]="i18n.t('vocab.cancel')" variant="danger" icon="trash-2" [navPadding]="true"
    (confirmed)="confirmDelete()" (cancelled)="cancelDelete()" />

<!-- Toast Notification -->
@if (toastMessage()) {
<div class="toast" [class.toast--error]="toastType() === 'error'">
    <app-icon [name]="toastType() === 'error' ? 'alert-circle' : 'check'" [size]="18" />
    <span>{{ toastMessage() }}</span>
</div>
}

<!-- Filter Picker -->
<app-option-picker [options]="filterOptions()" [value]="levelFilter()" [isOpen]="filterPickerOpen()"
    [title]="i18n.t('vocab.filterByLevel')" [navPadding]="true" (selected)="onLevelFilterChange($event)"
    (closed)="filterPickerOpen.set(false)" />

<!-- Level Picker -->
<app-option-picker [options]="levelOptions()" [value]="getEditingItemLevel()" [isOpen]="levelPickerOpen()"
    [title]="i18n.t('vocab.changeLevel')" [navPadding]="true" (selected)="onLevelChange($event)"
    (closed)="levelPickerOpen.set(false); editingItemId.set(null)" />

<!-- Menu Sheet (Export/Import) -->
<app-bottom-sheet [isOpen]="menuOpen()" [showCloseButton]="true" [navPadding]="true" (closed)="menuOpen.set(false)">
    <div class="menu-sheet">
        <h3 class="menu-sheet__title">{{ i18n.t('vocab.options') }}</h3>
        <div class="menu-sheet__options">
            <button class="menu-option" (click)="exportJSON(); menuOpen.set(false)">
                <app-icon name="download" [size]="18" />
                <span>{{ i18n.t('vocab.exportJson') }}</span>
            </button>
            <button class="menu-option" (click)="exportAnki(); menuOpen.set(false)">
                <app-icon name="download" [size]="18" />
                <span>{{ i18n.t('vocab.exportAnki') }}</span>
            </button>
            <label class="menu-option">
                <app-icon name="upload" [size]="18" />
                <span>{{ i18n.t('vocab.import') }}</span>
                <input type="file" accept=".json" class="hidden-input"
                    (change)="importJSON($event); menuOpen.set(false)" />
            </label>
        </div>
    </div>
</app-bottom-sheet>